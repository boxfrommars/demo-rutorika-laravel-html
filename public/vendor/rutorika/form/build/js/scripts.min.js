$(document).ready(function(){ace.config.set("basePath","/vendor/rutorika/form/vendor/ace/src-noconflict/"),$(".rk-code-field").each(function(){var e=$(this),a=ace.edit(e.siblings(".rk-code").get(0));a.$blockScrolling=1/0;var t=e.data("mode")||"html",n=e.data("theme")||"textmate";a.setTheme("ace/theme/"+n),a.getSession().setMode("ace/mode/"+t),a.getSession().setValue(e.val()),a.getSession().on("change",function(){e.val(a.getSession().getValue())})})}),$(document).ready(function(){$(".rk-color-field").each(function(){var e=$(this),a=e.data("minicolors");a=$.extend({theme:"bootstrap"},a),e.minicolors(a)})}),$(function(){$(".rk-datetimepicker").each(function(){var e=$(this).find("input"),a=e.data("datetime");$(this).datetimepicker(a)})}),L.Icon.Default.imagePath="/vendor/rutorika/form/vendor/leaflet-0.7.5/images",$(document).ready(function(){function e(e){return e?e.split(":"):null}$(".rk-geopoint-field").each(function(){function a(e){o?o.setLatLng(e):(o=L.marker(e,{draggable:!0}).addTo(s),o.on("dragend",function(e){var t=this.getLatLng();a(t),r.val(t.lat+":"+t.lng)})),s.panTo(e)}function t(){o&&(s.removeLayer(o),o=null)}function n(e,a,t){var n=r.data("type")||t;return a.indexOf(n)<0&&(console.warn(e+" doesnt support `"+n+"` type. Only "+a.join(" | ")+". Fallback to "+t),n=t),n}var o,r=$(this),i=$(this).siblings(".rk-map"),l=r.data("layer")||"osm",d=$.extend({center:[51.476852,-498e-6],zoom:12},r.data("map")||{}),c=e(r.val());c&&(d.center=c);var s=new L.Map(i.get(0),d);c&&a(c);var u,p;switch(l){case"yandex":p=n("Yandex",["map","satellite","hybrid","publicMap","publicMapHybrid"],"publicMap"),u=new L.Yandex(p);break;case"osm":p=r.data("type")||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",0!==p.indexOf("http")&&0!==p.indexOf("//")&&(console.warn("OSM doesnt support `"+p+"` type. Fallback to http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),p="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),u=new L.TileLayer(p);break;case"google":p=n("Google",["ROADMAP","SATELLITE","HYBRID","TERRAIN"],"ROADMAP"),u=new L.Google("ROADMAP");break;case"bing":p=n("Bing",["Road","Aerial","AerialWithLabels","Birdseye","BirdseyeWithLabels"],"Road"),u=new L.BingLayer("AvoUren6Dm0PAAyhkqPcEQs3PtNsC_VHqb2Pxyac59fd-YME_3FZ_6No4BL5iEAe",{type:p});break;default:console.warn("Layer `"+l+"` doesn't supported, you should use one of yandex, google, osm or bing. Fallback to OSM layer"),u=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")}s.addLayer(u),r.on("change",function(){var n=r.val();if(n){var o=e(n);a(o)}else t()}),s.on("click",function(e){a(e.latlng),r.val(e.latlng.lat+":"+e.latlng.lng)})})}),$(".rk-select2").each(function(){function e(e){e.select2({theme:"bootstrap"})}var a=$(this),t=a.val(),n=a.data("value"),o=a.data("ajax--url");if(o&&n&&!t){var r=$.ajax({url:o+"/init",data:{ids:n}});r.then(function(t){t.results.forEach(function(e){var t=$("<option>").text(e.text).attr("value",e.id).prop("selected",!0);a.prepend(t)}),e(a)})}else e(a)}),$(document).ready(function(){$(".rk-upload-container .rk-upload-preview a").magnificPopup({type:"image"}),$(".rk-uploader-field").each(function(){var e=$(this),a=e.siblings(".rk-upload-container");a.find("input:file").fileupload({dataType:"json",url:e.data("url")||"/upload",paramName:"file",formData:[{name:"type",value:e.data("type")||"default"}],done:function(t,n){var o=n.result;e.val(o.filename);var r=a.find(".rk-upload-preview");r.find("a").attr("href",o.path),r.find("img,audio").attr("src",o.path),a.find(".rk-upload-link").text(o.filename).attr("href",o.path)},fail:function(e,a){console.error("Whooooops",e,a)}})}),$(".rk-upload-remove").on("click",function(e){e.preventDefault();var a=$(this).parents(".rk-upload-container");a.siblings(".rk-uploader-field").val(""),a.find(".rk-upload-result").attr("href",""),a.trigger("removed",[a])}),$(".rk-upload-image-container").on("removed",function(){$(this).find(".rk-upload-result img").attr("src","")}),$(".rk-upload-audio-container").on("removed",function(){$(this).find(".rk-upload-result audio").attr("src","")}),$(".rk-upload-file-container").on("removed",function(){$(this).find(".rk-upload-result").text("")})});